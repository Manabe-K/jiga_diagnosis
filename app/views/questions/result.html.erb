<% content_for :meta_tags do %>
  <% og_title = "Lv.#{@character[:level]}「#{@character[:name]}」でした！" %>
  <% og_description = @character[:description].truncate(60) %>
  <% og_image = image_url("ogp_levels/level#{@character[:level]}.png") %>

  <meta property="og:title" content="<%= og_title %>" />
  <meta property="og:description" content="<%= og_description %>" />
  <meta property="og:image" content="<%= og_image %>" />
  <meta property="og:url" content="<%= request.original_url %>" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="自己主張レベル診断" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="<%= og_title %>" />
  <meta name="twitter:description" content="<%= og_description %>" />
  <meta name="twitter:image" content="<%= og_image %>" />
<% end %>

<% if @character.present? %>
  <% tweet_text = "自己主張は、Lv#{@character[:level]}「#{@character[:name]}」でした。\nあなたの自己主張レベルはどれくらい？" %>
  <% tweet_url = request.original_url.presence || root_url %>
  <% share_url = "https://twitter.com/intent/tweet?text=#{ERB::Util.url_encode(tweet_text)}&url=#{ERB::Util.url_encode(tweet_url)}&hashtags=#{ERB::Util.url_encode('自己主張レベル診断,結果に根拠はありません')}" %>

  <div class="min-h-screen bg-[#fefaf5] flex items-center justify-center px-6 sm:px-10 py-20 font-zen">
    <div class="w-full max-w-xl bg-white border-[#f5e9db] rounded-2xl shadow-xl text-center px-8 sm:px-12 py-10 space-y-6">

      <p class="text-lg sm:text-xl text-[#5b4b3e] leading-relaxed">
        あなたの<br class="sm:hidden">自己主張レベルは…
      </p>

      <div class="text-3xl sm:text-3xl font-extrabold text-[#4b3e2e] animate-pulse">
        Lv.<%= @character[:level] %>：<%= @character[:name] %>
      </div>

      <!-- ✅ 高さを確保してパチッと表示防止 -->
      <div class="my-4 min-h-[256px] flex items-center justify-center">
        <%= image_tag "ego_levels/level#{@character[:level]}.png",
            alt: "Lv#{@character[:level]}のキャラ画像",
            class: "w-64 h-auto mx-auto rounded-xl shadow-md",
            loading: "lazy" %>
      </div>

      <p class="text-base sm:text-lg text-gray-700 max-w-prose leading-relaxed mx-auto">
        <%= simple_format(@character[:description]) %>
      </p>

      <!-- 🔁 再診ボタン -->
      <%= link_to "もう一度診断する", root_path,
        class: "inline-block bg-[#e4b74c] hover:bg-[#d3a841] text-white font-bold text-lg px-10 py-4 rounded-full shadow-md transition hover:scale-105 duration-200" %>

      <!-- 🐦 Xシェアボタン -->
      <%= link_to "▶ Xで結果をシェアする", share_url,
        class: "inline-block bg-[#4b3e2e] hover:bg-[#3a2f22] text-white font-bold text-base px-8 py-3 rounded-full shadow-md transition hover:scale-105 duration-200",
        target: "_blank", rel: "noopener noreferrer" %>

    </div>
  </div>
<% else %>
  <p class="text-gray-500 text-center py-10">診断に失敗しました。</p>
<% end %>